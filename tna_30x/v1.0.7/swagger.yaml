openapi: '3.0.2'
info:
  title: Tachyon Networks Public API v1.0.7
  version: '1.0.7'
  description: Use this API to access information and configure your Tachyon Networks TNA-300 series devices, running firmware 1.12.2 and later. Additional usage tips can be found on the support site <a href="https://tachyon-networks.freshdesk.com/support/solutions/articles/67000659777-tna-30x-restful-api" target="_new">here</a>.
servers:
  - url: http://{deviceMgmtIp}/cgi.lua/apiv1
    variables:
      deviceMgmtIp:
        default: 192.168.2.1
        description: Device's management IP address
security:
  - cookieAuth: []
paths:
  /login:
    post:
      description: Post login credentials to your device in order to authenticate your client.
      requestBody:
        content: 
          application/json:
            schema:
              type: object
              properties:
                username: 
                  description: User's username
                  type: string
                  example: root
                password:
                  description: User's password
                  type: string
                  example: admin
      responses: 
        200:
          description: Successful login response containing api token.
          content:
            application/json:
              schema:
                type: object
                properties: 
                  token:  
                    type: string
                    example: BCIHXGDDAAAAAAGVLFXNDYXRCCCJKGQFFA2F7BW2VPPN6===
                    description: API token that will need to be included in subsequent API requests.
                  level: 
                    type: integer
                    example: 0
                    enum: [0,9]
                    description: User access level.  0 = Admin, 9 = Read-only.
                  auth: 
                    type: boolean
                    example: true
                    description: Authorization status.
        401:
          description: Failed login response. 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'

    delete:    
      description: Logout of your API session.
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API token representing the session you wish to delete.
          required: true
      responses:
        200: 
          description: Ok status response is always returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessReponse'
  /reboot:
    post:    
      description: Reboot the device
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
      responses:
        200: 
          description: Ok status response is always returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessReponse'
  /update:
    get:
      description: Get the current firmware task status details, if they exist.
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
      responses:
        200:
          description: Response object containing details about the current firmware upgrade task. An empty object will be returned if no task exists.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    description: Status of the current firmware update task. 
                    type: string
                    enum: [FAIL, SUCCESS, IN_PROGRESS]
                    example: FAIL
                  state:
                    description: Current state of the firmware update task. 
                    type: string
                    enum: [FIMRWARE_DOWNLOAD, FIRMWARE_FLASHING]
                    example: FIMRWARE_DOWNLOAD
                  last_changed:
                    description: Timestamp of the last change to the firmware update task.
                    type: integer
                    example: 1621635010
                  error: 
                    description: Optional detailed error message in the case of the FAIL status.
                    type: string
                    example: "Unable to download file: curl(6) - Couldn't resolve host 'bad-firmware-url.com'"
                  comment:
                    description: Optional non-error comment/message regarding the task's current status.  This field is only populated after flashing is complete.
                    type: string
                    example: Reboot device for the new firmware to become active.
                  URL: 
                    description: Optional URL of the firmware provided by the user. Included for FIRMWARE_DOWNLOAD states.
                    type: string
                    example: https://bad-firmware.url
              examples:
                no-task: 
                  value: 
                    {}
                bad-url: 
                  value: 
                    {"statusCode":400,"error":{"details":"Invalid firmware URL, only http/https protocols are currently supported.","path":"/cgi.lua/apiv1/update"},"description":"Bad Request"}
                download-success: 
                  value: 
                    {"status":"SUCCESS","url":"https://tachyon-networks.com/fw/tna-30x-1.11.1-r53981-20230426-tn-110-prs-squashfs-sysupgrade.bin","state":"FIRMWARE_DOWNLOAD","last_changed":1682628473}
                download-failure: 
                  value: 
                    {"state":"FIRMWARE_DOWNLOAD","last_changed":1682628379,"status":"FAIL","url":"https://badurl.com","error":"Unable to download file: curl: (28) Failed to connect to badurl.com port 443: Operation timed out\n"}
                flashing-in-progress:
                  value:
                    {"status":"IN_PROGRESS","last_changed":1682628956,"state":"FIRMWARE_FLASHING"}
                flashing-complete:
                  value:
                    {"status":"COMPLETE","last_changed":1682628969,"comment":"Reboot device for the new firmware to become active.","state":"FIRMWARE_FLASHING"}
                flashing-failure:
                  value:
                    {"status":"FAIL","url":"Invalid firmware upgrade: local firmware file is missing.","state":"FIRMWARE_FLASHING","last_changed":1682890699}
        400:
          description: Failure response for an invalid request, such as missing one or more parameters.
          content:
            application/json:
              schema:
                type: object
              examples: 
                invalid-url:
                  value:
                    {"statusCode":400,"error":{"details":"Invalid firmware URL, only http/https protocols are currently supported.","path":"/cgi.lua/apiv1/update"},"description":"Bad Request"}  
        401:
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
    put:
      description: Instruct the device to asynchronously download a firmware file from the specified URL. 
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
      requestBody:
        content: 
          application/json:
            schema:
              required: [firmware_url]
              type: object
              properties:
                firmware_url: 
                  description: URL of firmware file.
                  type: string
                  example: https://tachyon-networks.com/firmware/tna-30x-1.11.0-upgrade-squashfs.bin
      responses:
        200: 
          description: Success response returned after performing basic validation on the parameters. Use the GET /update route to fetch the actual download status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessReponse'
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
        400:
          description: Failure response for an invalid request, such as missing one or more parameters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    description: Status code.
                    type: integer
                    example: 400
                  description:
                    description: Description of the error.
                    type: string
                    example: Missing Firmware URL.
    post:
      requestBody:
        content: 
          application/json:
            schema:
              type: object
              properties:
                reset: 
                  description: (Optional) Whether or not the device should be reset to defaults after flashing is complete.
                  type: boolean
                  example: false 
                  default: false  
                force:
                  description: (Optional) Whether or not the device should force flash the firmware image, even if it appears invalid.  Please contact support if you plan on using this field.
                  type: boolean
                  example: false 
                  default: false 
      description: Instruct the device to begin flashing the previously-downloaded firmware to the alternate bootbank, and optionally reset to defaults upon next bootup. This process will not affect the operation of the device - firmware will be updated only upon reboot.  The same goes for resetting to defaults. 
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
      responses:
        200: 
          description: Success response will be returned if firmware was successfully downloaded and validated, and flashing has begun.  Use the GET /update route to check on the status of the flashing process.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessReponse'
        400: 
          description: Failure response for an invalid request, such as missing one or more parameters, or a missing firmware image.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
              examples:
                no-firmware-uploaded:
                  value: {"statusCode":400,"error":{"details":"Invalid firmware upgrade: local firmware file is missing.","path":"/cgi.lua/apiv1/update"},"description":"Bad Request"}

                bad-firmware-file:
                  value: {"statusCode":400,"error":{"details":"Invalid firmware file: local firmware file didn't pass validation.","path":"/cgi.lua/apiv1/update"},"description":"Bad Request"}
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
  /stats:
    get:
      description: Fetch system, wireless, ethernet, and/or network statistics from the device.
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
        - in: query
          name: type
          schema:
            type: string
            example: system,wireless
          description: "Type of stats to fetch: system, wireless, ethernet, and/or network (multiple types can be specified in a comma-seperated list)."
          required: true
      responses: 
        200:
          description: JSON object containing the requested stats. See output examples below.  These should roughly match up to what's shown in the web UI dashboard.  Note - in firmware v1.10.3 (earliest fw), the system stats response will NOT contain the firmware version field.
          content:
            application/json:
              schema:
                type: object
              examples:
                wireless-stats:  
                  value:
                        {
                      "wireless": {
                        "peers": [
                          {
                            "system_name": "Tachyon 303X demo client",
                            "system_description": "Tachyon Networks TNA-303X+AK100: v1.11.2 r54120",
                            "rx_bytes": 3054236,
                            "rx_sector": 32,
                            "snr": 16,
                            "rssi": -42,
                            "retry_histogram": {
                              "0": 1350,
                              "7-9": 0,
                              "4-6": 3,
                              "10+": 0,
                              "1-3": 8
                            },
                            "tx_packets": 325,
                            "rx_packets": 24299,
                            "connection_time": 5494,
                            "mac": "78:5E:E8:D0:10:22",
                            "ipv6": "fe80::7a5e:e8ff:fed0:1020",
                            "rx_mcs": 9,
                            "tx_mcs": 11,
                            "ipv4": "192.168.201.150",
                            "tx_rate": 3850,
                            "mcs_histogram": {
                              "mcs_9": 2,
                              "mcs_7": 0,
                              "mcs_3": 0,
                              "mcs_2": 0,
                              "mcs_5": 0,
                              "mcs_1": 0,
                              "mcs_10": 1,
                              "mcs_12": 0,
                              "mcs_8": 0,
                              "mcs_11": 1344,
                              "mcs_4": 0,
                              "mcs_6": 3
                            },
                            "tx_sector": 32,
                            "tx_bytes": 50158,
                            "remote_rssi": -51,
                            "iface_name": "prs0",
                            "rx_rate": 2502,
                            "est_link_distance": 11,
                            "antenna_kit": "ak+100",
                            "model": "TNA-303X",
                            "radio_name": "wlan0"
                          },
                          {
                            "system_name": "Tachyon 302 lab client",
                            "system_description": "Tachyon Networks TNA-302: v1.11.2 r54120",
                            "rx_bytes": 3058100,
                            "rx_sector": 32,
                            "snr": 12,
                            "rssi": -46,
                            "retry_histogram": {
                              "0": 1349,
                              "7-9": 0,
                              "4-6": 2,
                              "10+": 0,
                              "1-3": 17
                            },
                            "tx_packets": 323,
                            "rx_packets": 24297,
                            "connection_time": 5493,
                            "mac": "78:5E:E8:D0:00:24",
                            "ipv6": "fe80::7a5e:e8ff:fed0:22",
                            "rx_mcs": 1,
                            "tx_mcs": 9,
                            "ipv4": "192.168.99.152",
                            "tx_rate": 2502,
                            "mcs_histogram": {
                              "mcs_9": 1343,
                              "mcs_7": 4,
                              "mcs_3": 1,
                              "mcs_2": 0,
                              "mcs_5": 0,
                              "mcs_1": 0,
                              "mcs_10": 0,
                              "mcs_12": 0,
                              "mcs_8": 0,
                              "mcs_11": 0,
                              "mcs_4": 1,
                              "mcs_6": 0
                            },
                            "tx_sector": 32,
                            "tx_bytes": 42483,
                            "remote_rssi": -47,
                            "iface_name": "prs1",
                            "rx_rate": 385,
                            "est_link_distance": 10,
                            "antenna_kit": "none",
                            "model": "TNA-302",
                            "radio_name": "wlan0"
                          }
                        ],
                        "histogram_updated_at": 1672898129,
                        "radios": {
                          "wlan0": {
                            "antenna_kit": "none",
                            "channel_width": 2160,
                            "op_mode": "master",
                            "ptp": false,
                            "ssid": "boring-ssid-name",
                            "radio_temp": 46,
                            "freq": 69120,
                            "modem_temp": 50,
                            "name": "wlan0",
                            "channel": 6,
                            "tx_power": 40,
                            "mac": "78:5E:E8:D0:FF:F3",
                            "security": "WPA2-PSK (GCMP)"
                          }
                        }
                      }
                    }
                ethernet-stats:
                  value: 
                    {"ethernet":{"ports":{"eth0":{"rx_bytes":1299436,"tx_bytes":4841326,"link":true,"autoneg":true,"port":4,"tx_error":0,"rx_packets":7758,"speed":2500,"rx_error":0,"tx_packets":4631,"duplex":"full"},"eth1":{"rx_bytes":0,"tx_bytes":1088289,"link":false,"autoneg":true,"tx_packets":5964,"rx_packets":0,"tx_error":0,"poe_out":true,"port":3,"rx_error":0}},"switch_mac":"78:5E:E8:D0:FF:F1"}}
                system-stats:
                  value:
                    {"system":{
                    "bootbanks": {
                    "backup": {
        "bootbank": 1,
        "version": "1.11.2 rev 54120"
      },
      "active": {
        "bootbank": 2,
        "version": "1.11.2 rev 54128"
      }
    },"epoch_time":1672872740,"fw_version":"1.11.2 rev 54120","serial_no":"TNA30100036B10","cpu_usage_percent":0,"memory":{"used":133083136,"usage":32,"total":419270656,"free":286187520},"name":"Tachyon Networks PtMP","model":"TNA-301","location":"A/V Closet","hostname":"tachyon-ptmp-ap","clock_datetime":"2023/01/04 14:52:20","cpu_temp":47}}
                network-stats:
                  value:
                    {"network":{"zones":{"wan":{"mgmt_vlan":{"enabled":false},"data_bridge":{"mac":"78:5E:E8:D0:FF:F1","ipv6":{"ip_address":["fe80::7a5e:e8ff:fed0:fff1/64"]},"data_vlan":{"enabled":false},"ipv4":{"ip_address":["192.168.99.48/24"],"gateway":"192.168.99.1"},"interface":"br-wan"}}},"dns":{"wan":["1.1.1.1","1.0.0.1"],"dhcp.br-wan":["1.1.1.1","8.8.8.8"]},"hostname":"tachyon-ptmp-ap","dhcp_status":{"br-wan":[[{"discovery":true,"lease_server":"192.168.99.1","fallback":{"prefix":24,"ip":"192.168.1.1"},"custom_dns":true,"ip":"192.168.99.48","prefix":24,"gateway":"192.168.99.1","metric":0,"lease_acquired":1672872614,"status":"renew","lease_lifetime":600}]]},"dns6":{"wan":{},"dhcp.br-wan":{}}}}
                network-stats-with-vlans:
                  value: 
                    {"network":{"zones":{"wan":{"mgmt_vlan":{"enabled":true,"ipv6":{"ip_address":["fe80::7a5e:e8ff:fed0:1020/64"]},"vlan_id":106,"ipv4":{"ip_address":["192.168.201.150/24"],"gateway":"192.168.201.1"},"mac":"78:5E:E8:D0:10:20","interface":"br-mgmt106"},"data_bridge":{"mac":"78:5E:E8:D0:10:20","ipv6":{"ip_address":["fe80::7a5e:e8ff:fed0:1020/64"]},"data_vlan":{"enabled":true,"vlan_id":99},"ipv4":{"ip_address":["192.168.3.1/24"]},"interface":"br-wan"}}},"dns":{"wan":{},"dhcp.br-mgmt106":["8.8.8.8"]},"hostname":"tachyon-networks","dhcp_status":{"br-mgmt106":[[{"discovery":true,"lease_server":"192.168.201.1","fallback":{"prefix":24,"ip":"192.168.1.2"},"custom_dns":true,"ip":"192.168.201.150","prefix":24,"metric":0,"gateway":"192.168.201.1","lease_acquired":1672872914,"status":"renew","lease_lifetime":600}]]},"dns6":{"wan":{},"dhcp.br-mgmt106":{}}}}
  /speedtest:
    get:
      description: Get the last results of a speedtest initiated via the POST /speedtest route. 
      responses: 
        200:
          description: JSON object containing the last speedtest results, or an empty object if none exists. See the support site for additional examples.
          content:
            application/json:
              schema:
                type: object
                properties: 
                  last_changed:  
                    type: integer
                    example: 1672813492
                    description: Timestamp containing the date/time that the speedtest results were last updated.
                  peer_mac: 
                    type: string
                    example: 78:5E:E8:D0:00:24
                    description: The MAC address of the peer where the speedtest was run.
                  reverse: 
                    type: boolean
                    example: true
                    description: Whether or not this speedtest direction was reversed.
                  status: 
                    type: string
                    example: ok
                    enum: [ok, error]
                    description: General status of the speedtest.
                  error: 
                    type: string
                    example: "speedtest: already running, aborted"
                    description: Description of the error, if status is set to 'error'
                  mbps: 
                    type: number
                    example: 2186.33056640625
                    description: The speed in mbps achieved during this speedtest. This will be missing if the speedtest could not be run. 
              examples:
                valid-test: 
                  value:
                    {"last_changed":1673316582,"peer_mac":"78:5E:E8:D0:10:22","reverse":false,"status":"ok","mbps":2714.90576171875}
                valid-no-results:
                  value: {}
                error-no-response:
                  value: {"last_changed":1673316706,"peer_mac":"78:5E:E8:D0:10:23","reverse":false,"status":"error","error":"Remote peer does not respond"}
                error-already-running: 
                  value: {"last_changed":1673316639,"peer_mac":"78:5E:E8:D0:10:22","reverse":false,"status":"error","error":"speedtest: already running, aborted."}
                error-invalid-peer:
                  value: {"last_changed":1673316673,"peer_mac":"blahblah","reverse":false,"status":"error","error":"Invalid peer 78 (detected 2 peer(s))"}
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
    post:
      description: Begin a speedtest. Peer MAC is only required when performing a speedtest on a device in Access Point mode.
      parameters:
        - in: cookie
          name: api_token
          schema:
            type: string
          description: API auth token.
          required: true
      requestBody:
        content: 
          application/json:
            schema:
              type: object
              properties:
                peer_mac: 
                  description: The wireless (wlan0) MAC address of the peer device to which you want to perform a speedtest.  Optional when device is operating in station mode.
                  type: string
                  example: 78:5E:E8:D0:00:24
                reverse:
                  description: Set the reverse field to true if you want the speed test to run in reverse. (optional) 
                  type: boolean
                  example: false
                  default: true
      responses: 
        200: 
          description: Success response when starting a speedtest.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessReponse'    
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse' 
        400:
          description: Invalid request.
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode: 
                    description: Error status code matching HTTP status code.
                    type: integer
                    example: 400
                  description:
                    description: Short description of the error.
                    example: Bad Request
                    type: string
                  error: 
                    type: object
                    properties:
                      details:
                        description: Detailed error message.
                        type: string
                        example: Peer mac is required for AP mode.
                      path:
                        type: string
                        description: Route where this error occurred.
                        example: /cgi.lua/apiv1/speedtest
  /bridge_table:
    get:
      description: Get the output of the bridge table.
      responses: 
        200:
          description: JSON object containing this device's bridge table entries.  The value for the bridge_table field will be an empty object {} when there are no entries.
          content:
            application/json:
              schema:
                type: object
                properties: 
                  bridge_table:  
                    type: array
                    items:
                      type: object
                      properties:
                        mac:
                          description: MAC address of the bridge table entry.
                          type: string
                          example: 78:28:ca:32:3c:08
                        bridge: 
                          description: The name of the bridge interface containing this MAC.
                          type: string
                          example: br-wan
                        iface:
                          description: The interface behind which this MAC address lives. 
                          type: string
                          example: eth0
              examples:
                ap-bridge-table: 
                  value:
                    {"bridge_table":[{"mac":"0c:62:a6:98:b9:21","bridge":"br-wan","iface":"eth0"},{"mac":"04:5d:4b:2c:10:b5","bridge":"br-wan","iface":"eth0"},{"mac":"00:0c:29:b5:8f:ed","bridge":"br-wan","iface":"eth0"},{"mac":"78:28:ca:32:3c:08","bridge":"br-wan","iface":"eth0"},{"mac":"44:07:0b:63:8d:11","bridge":"br-wan","iface":"eth0"},{"mac":"94:9f:3e:03:0a:f4","bridge":"br-wan","iface":"eth0"},{"mac":"c4:f1:74:78:a9:32","bridge":"br-wan","iface":"eth0"},{"mac":"24:5e:be:4e:70:d3","bridge":"br-wan","iface":"eth0"},{"mac":"44:61:32:7a:02:41","bridge":"br-wan","iface":"eth0"},{"mac":"78:28:ca:32:3b:cc","bridge":"br-wan","iface":"eth0"},{"mac":"94:9f:3e:7b:8e:3a","bridge":"br-wan","iface":"eth0"},{"mac":"c4:93:00:32:f2:e5","bridge":"br-wan","iface":"eth0"},{"mac":"dc:2c:6e:44:09:47","bridge":"br-wan","iface":"eth0"},{"mac":"78:5e:e8:d0:00:18","bridge":"br-wan","iface":"eth0"},{"mac":"78:5e:e8:00:0d:05","bridge":"br-wan","iface":"eth0"},{"mac":"da:eb:58:31:f0:cc","bridge":"br-wan","iface":"eth0"},{"mac":"94:9f:3e:03:01:ec","bridge":"br-wan","iface":"eth0"},{"mac":"2c:fd:b3:a9:56:e4","bridge":"br-wan","iface":"eth0"},{"mac":"94:9f:3e:7c:9b:aa","bridge":"br-wan","iface":"eth0"},{"mac":"6e:30:2a:b9:a5:ef","bridge":"br-wan","iface":"eth0"},{"mac":"1c:57:dc:7e:99:99","bridge":"br-wan","iface":"eth0"},{"mac":"00:0c:29:6f:bb:4e","bridge":"br-wan","iface":"eth0"},{"mac":"90:0f:0c:5e:93:ab","bridge":"br-wan","iface":"eth0"},{"mac":"ba:1c:d8:f2:53:04","bridge":"br-wan","iface":"eth0"},{"mac":"94:3c:c6:6b:80:28","bridge":"br-wan","iface":"eth0"},{"mac":"5a:1e:49:e8:0d:8f","bridge":"br-wan","iface":"eth0"},{"mac":"78:5e:e8:d0:10:20","bridge":"br-wan","iface":"prs0"},{"mac":"78:5e:e8:d0:00:22","bridge":"br-wan","iface":"prs1"}]}
                empty:
                  value: {"bridge_table":{}}

        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
              example:
                unauth:
                  {
                  "statusCode": 401,
                  "description": "Unauthorized",
                  "error": {
                    "details": "Authorization Failed",
                    "path": "/cgi.lua/apiv1/bridge_table"
                  }
                }
  /config:
    get:
      description: Get the device's current configuration.  Go to the <a href="keys.html" target="_new">Config Key Specs</a> page to view the list of available configuration keys and values.
      responses:
        200:
          description: JSON object containing the device's current configuration.  
          content:
            application/json:
              schema:
                type: object
                example: {"config":{"system":{"device_name":"Tachyon Networks PtMP","reset_button":{"enabled":true},"hostname":"tachyon-ptmp-ap","users":[{"username":"root","type":"admin","password_hash":"$1$6Hzch.yD$ULugJ982Yb1D0g8zhqv3T.","enabled":true},{"username":"guest","type":"read-only","password_hash":"$1$/DpVqAVi$ZwWGYO83CGVclJeuwBb5C0","enabled":true},{"username":"new","type":"admin","password_hash":"$1$mokR7kX6$CvqYTxcq450LVAUjRHVM51","enabled":true},{"username":"guest1","type":"read-only","password_hash":"$1$ohSsj1Ga$xF6ruORwRp1TNYmUjRgQn0","enabled":true}],"device_location":"A/V Closet","timezone":"America/Los_Angeles"},"wireless":{"radios":{"wlan0":{"channel_width":2160,"antenna_kit": "none","ssid":"tachyon-ptmp","channel":6,"max_mcs":12,"mode":"ap","ptp":false,"passphrase":"passphrase","security":"wpapsk"}}},"network":{"wan":{"ipv6":{"enabled":false},"data_vlan":{"enabled":false},"ipv4":{"enabled":true,"prefix":24,"custom_dns":true,"dns_servers":["1.1.1.1","1.0.0.1"],"ipaddr":"192.168.1.1","dhcp_broadcast":false},"mgmt_vlan":{"enabled":false},"ip_mode":"dhcp"},"traffic_control":{"limit_download":{"enabled":false},"limit_upload":{"enabled":false}},"poe_out_enabled":false,"general":{"ageing_time":300,"mtu":1501}},"services":{"snmp":{"v2":{"enabled":true,"community":"public"},"v3":{"enabled":false}},"ping_watchdog":{"enabled":false},"http":{"https_port":443,"port":80},"remote_syslog":{"enabled":false},"snmp_traps":{"enabled":false},"discovery":{"enabled":true,"broadcast_protocols":{"lldp":true,"cdp":true,"mndp":true},"lldp_server":{"enabled":true}},"ntp":{"enabled":true,"servers":["time.google.com","time.cloudflare.com"]}}}}
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
              example:
                unauth:
                  {
                  "statusCode": 401,
                  "description": "Unauthorized",
                  "error": {
                    "details": "Authorization Failed",
                    "path": "/cgi.lua/apiv1/config"
                  }
                }
        500:
          description: JSON object containing error information in the event that a system or fatal error occurs while fetching the config.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
              example:
                unauth:
                  {
                  "statusCode": 500,
                  "description": "Internal Server Error",
                  "error": {
                    "details": "System error - internal conversion failed: (internal error detail here)",
                    "path": "/cgi.lua/apiv1/config"
                  }
                }
    post:
      requestBody:
        content: 
          application/json:
            schema:
              type: object
              properties:
                dry_run: 
                  description: Whether or not this should be a dry run - meaning the device's configuration will not be affected.  Set this flag if you wish to check for any errors or to view the list of changed keys before making any real changes.
                  type: boolean
                  example: false
                config:
                  description: The JSON object representing this device's configuration. Go to the <a href="keys.html" target="_new">Config Key Specs</a> page to view the list of available configuration keys and values.
                  type: object
                  example: {"system":{"device_name":"Tachyon Networks PtMP","reset_button":{"enabled":true},"hostname":"tachyon-ptmp-ap","users":[{"username":"root","type":"admin","password_hash":"$1$6Hzch.yD$ULugJ982Yb1D0g8zhqv3T.","enabled":true},{"username":"guest","type":"read-only","password_hash":"$1$/DpVqAVi$ZwWGYO83CGVclJeuwBb5C0","enabled":true},{"username":"new","type":"admin","password_hash":"$1$mokR7kX6$CvqYTxcq450LVAUjRHVM51","enabled":true},{"username":"guest1","type":"read-only","password_hash":"$1$ohSsj1Ga$xF6ruORwRp1TNYmUjRgQn0","enabled":true}],"device_location":"A/V Closet","use_advanced_timezones": true, "timezone":"America/Los_Angeles"},"wireless":{"radios":{"wlan0":{"channel_width":2160,"ssid":"tachyon-ptmp","channel":6,"max_mcs":12,"mode":"ap","ptp":false,"passphrase":"passphrase","security":"wpapsk"}}},"network":{"wan":{"ipv6":{"enabled":false},"data_vlan":{"enabled":false},"ipv4":{"enabled":true,"prefix":24,"custom_dns":true,"dns_servers":["1.1.1.1","1.0.0.1"],"ipaddr":"192.168.1.1","dhcp_broadcast":false},"mgmt_vlan":{"enabled":false},"ip_mode":"dhcp"},"traffic_control":{"limit_download":{"enabled":false},"limit_upload":{"enabled":false}},"poe_out_enabled":false,"general":{"ageing_time":300,"mtu":1501}},"services":{"snmp":{"v2":{"enabled":true,"community":"public"},"v3":{"enabled":false}},"ping_watchdog":{"enabled":false},"http":{"https_port":443,"port":80},"remote_syslog":{"enabled":false},"snmp_traps":{"enabled":false},"discovery":{"enabled":true,"broadcast_protocols":{"lldp":true,"cdp":true,"mndp":true},"lldp_server":{"enabled":true}},"ntp":{"enabled":true,"servers":["time.google.com","time.cloudflare.com"]}}}
      description: Update the device's configuration and restart networking services, or perform a dry run.  Go to the <a href="keys.html" target="_new">Config Key Specs</a> page to view the list of available configuration keys and values.
      responses:
        200:
          description: JSON object containing the information related to a successful configuration update operation.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status_message:
                      description: Detailed status message.
                      example: Configuration saved, applying changes now.
                      type: string
                  response:
                      description: JSON object containing information about the config update operation.
                      type: object 
                      properties: 
                        reboot_required: 
                          type: boolean
                          example: false
                          description: Whether or not a reboot is required to apply these changes.
                        warnings:
                          description: JSON object containing config key warnings. 
                          type: object
                        keys_added:
                          type: object
                          description: JSON object containing new config keys. 
                        keys_removed:
                          type: object
                          description: JSON object containing removed config keys. 
                        keys_changed:
                          type: object
                          description: JSON object containing changed config keys. 
                          
              examples:
                dry-run-ap-to-sta-mode-with-traffic-shaping: 
                  value:
                    status_message: Dry run only, no changes made on this device.
                    response:
                      reboot_required: true
                      keys_removed: {"wireless.radios.wlan0.channel":6}
                      keys_added: {"network.traffic_control.limit_upload.rate_limit":100}
                      keys_changed: {"wireless.radios.wlan0.mode":{"new":"sta","prev":"ap"},"network.traffic_control.limit_upload.enabled":{"new":true,"prev":false}}
                      warnings: { "wireless.radios.wlan0.channel":"The key wireless.radios.wlan0.channel is dependent on key wireless.radios.wlan0.mode being set to ap, which it isn't, and will be ignored." }
                config-change-add-user: 
                  value:
                    status_message: Configuration saved, applying changes now.
                    response:
                      reboot_required: false
                      keys_removed: {}
                      keys_added: {"system.users.4":{"username":"guest1","type":"read-only","password_hash":"$1$ohSsj1Ga$xF6ruORwRp1TNYmUjRgQn0", "enabled":true}}
                      keys_changed: {}
                      warnings: {}
                      
        500: 
          description: JSON object containing error information in the event that a system or fatal error occurs.
          content:
            application/json:
              schema:
                type: object
                properties: 
                  statusCode: 
                    description: Error status code matching HTTP status code.
                    type: integer
                    example: 500
                  description:
                    description: Short description of the error.
                    example: Internal Server Error
                    type: string
                  error: 
                    type: object
                    properties:
                      details:
                        description: Detailed error message.
                        type: string
                        example: "System error - failed to run config validation: (internal error detail here)"
                      path:
                        type: string
                        description: Route where this error occurred.
                        example: /cgi.lua/apiv1/config
        401:
          description: Unauthorized response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericFailureReponse'
        400:
          description: Failure response for an invalid request, such as missing one or more parameters, or for passing an invalid config JSON object. For an invalid config, only the first error is returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    description: Status code.
                    type: integer
                    example: 400
                  description:
                    description: Short description of the error.
                    example: Bad Request
                    type: string
                  error: 
                    type: object
                    properties:
                      details:
                        description: Detailed error message.
                        type: string
                        example: Missing config in POST data.
                      path:
                        type: string
                        description: Route where this error occurred.
                        example: /cgi.lua/apiv1/config
              examples:
                invalid-config-key: 
                  value:
                    statusCode: 400
                    description: "Bad Request"
                    error:
                      details: "Configuration validation failed: The key network.traffic_control.limit_upload.rate_limit is missing, but dependent on key network.traffic_control.limit_upload.enabled being set to true"
                      path: "/cgi.lua/apiv1/config"
                    
components:
  securitySchemes:
    cookieAuth:         # arbitrary name for the security scheme; will be used in the "security" key later
      type: apiKey
      in: cookie
      name: api_token
  schemas:
    GenericSuccessReponse:
      type: object
      properties:
        status:
          description: Status of the response. 
          type: string
          example: ok
    GenericFailureReponse:
      type: object
      properties: 
        statusCode: 
          description: Error status code matching HTTP status code.
          type: integer
          example: 401
        description:
          description: Short description of the error.
          example: Unauthorized
          type: string
        error: 
          type: object
          properties:
            details:
              description: Detailed error message.
              type: string
              example: Authorization Failed
            path:
              type: string
              description: Route where this error occurred.
              example: /cgi.lua/apiv1/stats

      